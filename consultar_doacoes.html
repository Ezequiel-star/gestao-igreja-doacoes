<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estoque e Hist√≥rico - Igreja Gest√£o</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        
        body {
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('imagen/cruz 2.jpg') no-repeat;
            background-size: cover; background-position: center; padding: 20px; color: #fff;
        }

        .container {
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px; backdrop-filter: blur(15px); padding: 40px; width: 100%; max-width: 1100px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        .header-actions { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 15px; 
        }

        h2 { color: #87ffad; text-transform: uppercase; }

        .table-container { 
            overflow-x: auto; background: rgba(0,0,0,0.2); border-radius: 15px; 
            border: 1px solid rgba(255,255,255,0.1); 
        }

        table { width: 100%; border-collapse: collapse; }
        th { background: rgba(255, 255, 255, 0.1); padding: 15px; text-align: left; color: #87ffad; }
        td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); }

        .btn-voltar { display: inline-block; margin-top: 30px; color: #ccc; text-decoration: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-actions">
            <h2>üì¶ Saldo e Hist√≥rico de Doa√ß√µes</h2>
            <button onclick="carregar()" style="padding: 10px; background: #87ffad; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">üîÑ Atualizar</button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Qtd</th>
                        <th>Doador/Origem</th>
                        <th>Validade</th>
                    </tr>
                </thead>
                <tbody id="tabelaCorpo"></tbody>
            </table>
        </div>
        <a href="menuprincipal.html" class="btn-voltar">‚Üê Voltar ao Menu</a>
    </div>

    <script>
        const token = localStorage.getItem('token') || localStorage.getItem('jwtToken');

        async function carregar() {
            try {
                // ROTA COM /api/ QUE VOC√ä J√Å SABE QUE FUNCIONA
                const res = await fetch('https://gestao-igreja-doacoes.onrender.com/api/doacao/listar', { 
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const dados = await res.json();
                const corpo = document.getElementById('tabelaCorpo');
                corpo.innerHTML = "";
                
                dados.forEach(d => {
                    corpo.innerHTML += `<tr>
                        <td><strong>${d.tipo_item}</strong></td>
                        <td>${d.quantidade}</td>
                        <td>${d.origem}</td>
                        <td>${d.data_validade ? new Date(d.data_validade).toLocaleDateString('pt-BR') : '-'}</td>
                    </tr>`;
                });
            } catch (e) { 
                console.error(e); 
            }
        }
        window.onload = carregar;
    </script>
</body>
</html>